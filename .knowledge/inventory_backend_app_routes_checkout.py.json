{"is_source_file": true, "format": "Python", "description": "This file implements Flask web routes for checkout sessions and Stripe webhook handling in an e-commerce backend. It facilitates creating checkout sessions, processing Stripe webhook events for successful payments, and updating order and inventory records accordingly.", "external_files": ["../db", "../models/order", "../models/product", "../schemas"], "external_methods": ["session_scope", "Order", "OrderItem", "StripeEvent", "Product", "Inventory", "CheckoutSessionRequestSchema", "CheckoutSessionResponseSchema"], "published": ["blp"], "classes": [{"name": "CheckoutSession", "description": "Handles the creation of Stripe checkout sessions and provisional order recording."}, {"name": "StripeWebhook", "description": "Handles incoming Stripe webhook events for payment completion, session expiration, and payment failures, updating order statuses and inventory accordingly."}], "methods": [{"name": "_get_stripe_client()", "description": "Creates and configures the Stripe client using environment variables, aborting if Stripe SDK isn't available or the secret key isn't set.", "scope": "", "scopeKind": ""}, {"name": "str _get_site_url()", "description": "Returns the base URL for redirects, configured via environment variable or defaults to localhost for development.", "scope": "", "scopeKind": ""}, {"name": "List[Dict] _build_line_items(items: List[Dict])", "description": "Constructs Stripe line items from provided cart items, validating product availability and inventory, aborting if invalid.", "scope": "", "scopeKind": ""}, {"name": "post(self)", "scope": "StripeWebhook", "scopeKind": "class", "description": "unavailable"}, {"name": "post(self, payload)", "scope": "CheckoutSession", "scopeKind": "class", "description": "unavailable"}], "calls": ["session_scope()", "select()", "abort()", "json.loads()", "stripe.checkout.Session.create()", "stripe.Webhook.construct_event()"], "search-terms": ["Stripe webhook", "checkout session", "inventory update", "stripe webhook secret", "build line items", "Stripe SDK import", "Stripe event handling", "order creation", "webhook event verification"], "state": 2, "file_id": 14, "knowledge_revision": 46, "git_revision": "31ffc5bceffefaa5e2b56864ca3596e6a7f7f7f3", "revision_history": [{"33": ""}, {"42": "31ffc5bceffefaa5e2b56864ca3596e6a7f7f7f3"}, {"45": "31ffc5bceffefaa5e2b56864ca3596e6a7f7f7f3"}, {"46": "31ffc5bceffefaa5e2b56864ca3596e6a7f7f7f3"}], "ctags": [{"_type": "tag", "name": "CheckoutSession", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^class CheckoutSession(MethodView):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "StripeWebhook", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^class StripeWebhook(MethodView):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_build_line_items", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^def _build_line_items(items: List[Dict]) -> List[Dict]:$/", "language": "Python", "typeref": "typename:List[Dict]", "kind": "function", "signature": "(items: List[Dict])"}, {"_type": "tag", "name": "_get_site_url", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^def _get_site_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_stripe_client", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^def _get_stripe_client():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "blp", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^blp = Blueprint($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "post", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^    def post(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "StripeWebhook", "scopeKind": "class"}, {"_type": "tag", "name": "post", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^    def post(self, payload):$/", "language": "Python", "kind": "member", "signature": "(self, payload)", "scope": "CheckoutSession", "scopeKind": "class"}, {"_type": "tag", "name": "stripe", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^    stripe = None$/", "language": "Python", "kind": "variable"}], "hash": "22fcf79285a0031392f3366b8721708c", "format-version": 4, "code-base-name": "inventory_backend", "filename": "inventory_backend/app/routes/checkout.py", "fields": [{"name": "blp = Blueprint(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "stripe = None", "scope": "", "scopeKind": "", "description": "unavailable"}]}