{"is_source_file": true, "format": "Python", "description": "This file defines server-side routes and handlers for checkout sessions and Stripe webhook processing in a Flask-based web application for an e-commerce system. It manages creating Stripe checkout sessions, handling webhook notifications from Stripe, and updating order and inventory state accordingly.", "external_files": ["../db", "../models/order", "../models/product", "../schemas"], "external_methods": ["session_scope", "Order", "OrderItem", "StripeEvent", "Product", "Inventory", "CheckoutSessionRequestSchema", "CheckoutSessionResponseSchema"], "published": ["CheckoutSession", "StripeWebhook"], "classes": [{"name": "CheckoutSession", "description": "Handles creation of Stripe checkout sessions and provisional order recording."}, {"name": "StripeWebhook", "description": "Handles incoming Stripe webhook events to update order status and inventory."}], "methods": [{"name": "_get_stripe_client()", "description": "Creates and returns a Stripe client configured with the secret key from environment variables.", "scope": "", "scopeKind": ""}, {"name": "str _get_site_url()", "description": "Resolves the site URL for redirect URLs, defaulting to localhost in dev environments.", "scope": "", "scopeKind": ""}, {"name": "List[Dict] _build_line_items(items: List[Dict])", "description": "Builds Stripe line items from a list of product IDs and quantities, validating inventory.", "scope": "", "scopeKind": ""}, {"name": "post(self)", "scope": "StripeWebhook", "scopeKind": "class", "description": "unavailable"}, {"name": "post(self, payload)", "scope": "CheckoutSession", "scopeKind": "class", "description": "unavailable"}], "calls": ["session_scope", "Order", "OrderItem", "StripeEvent", "Product", "Inventory", "abort", "json.loads", "stripe.checkout.Session.create", "stripe.Webhook.construct_event"], "search-terms": ["checkout", "StripeWebhook", "create checkout session", "stripe webhook handler", "Inventory update", "Order provisional", "Stripe SDK", "session_scope", "Stripe event", "checkout session creation"], "state": 2, "file_id": 14, "knowledge_revision": 33, "git_revision": "", "ctags": [{"_type": "tag", "name": "CheckoutSession", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^class CheckoutSession(MethodView):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "StripeWebhook", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^class StripeWebhook(MethodView):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_build_line_items", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^def _build_line_items(items: List[Dict]) -> List[Dict]:$/", "language": "Python", "typeref": "typename:List[Dict]", "kind": "function", "signature": "(items: List[Dict])"}, {"_type": "tag", "name": "_get_site_url", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^def _get_site_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_stripe_client", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^def _get_stripe_client():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "blp", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^blp = Blueprint($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "post", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^    def post(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "StripeWebhook", "scopeKind": "class"}, {"_type": "tag", "name": "post", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^    def post(self, payload):$/", "language": "Python", "kind": "member", "signature": "(self, payload)", "scope": "CheckoutSession", "scopeKind": "class"}, {"_type": "tag", "name": "stripe", "path": "/home/kavia/workspace/code-generation/serverless-e-commerce-checkout-system-215564-215573/inventory_backend/app/routes/checkout.py", "pattern": "/^    stripe = None$/", "language": "Python", "kind": "variable"}], "hash": "79efbdf7722f326a03275cb8004bcc6a", "format-version": 4, "code-base-name": "inventory_backend", "filename": "inventory_backend/app/routes/checkout.py", "fields": [{"name": "blp = Blueprint(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "stripe = None", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"33": ""}]}